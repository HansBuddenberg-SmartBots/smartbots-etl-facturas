<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ETL Consolidación - Parcial</title>
  <style>
    body { margin: 0; padding: 0; background-color: #f4f4f4; font-family: Arial, sans-serif; }
    table { border-spacing: 0; width: 100%; }
    img { display: block; max-width: 100%; height: auto; }
    .email-container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px; }
    .email-header { padding: 10px 0; text-align: center; background-color: #ffffff; border-bottom: 1px solid #e0e0e0; }
    .email-header img { margin: 0 auto; display: inline-block; width: 100px; height: auto; }
    .email-content { padding: 20px; color: #333333; line-height: 1.6; }
    .email-footer { text-align: center; padding: 10px; background-color: #f9fafb; border-top: 1px solid #e0e0e0; font-size: 11px; color: #666666; }
    .badge-warning { display: inline-block; padding: 4px 12px; background-color: #fff3cd; color: #856404; border-radius: 4px; font-weight: bold; }
    .summary-table { width: 100%; border-collapse: collapse; margin: 12px 0; }
    .summary-table th, .summary-table td { padding: 8px 12px; border: 1px solid #dee2e6; text-align: left; font-size: 13px; }
    .summary-table th { background-color: #f8f9fa; font-weight: 600; }
    .error-table { width: 100%; border-collapse: collapse; margin: 12px 0; }
    .error-table th, .error-table td { padding: 6px 10px; border: 1px solid #f5c6cb; text-align: left; font-size: 12px; }
    .error-table th { background-color: #f8d7da; color: #721c24; font-weight: 600; }
  </style>
</head>

<body>
  <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #f4f4f4;">
    <tr>
      <td align="center">
        <table class="email-container" cellpadding="0" cellspacing="0">
          <!-- Header -->
          <tr>
            <td class="email-header">
              <img src="https://smart-bots.cl/logo_santahelena.jpg" alt="Santa Elena">
            </td>
          </tr>

          <!-- Content -->
          <tr>
            <td class="email-content">
              <p>Estimados,</p>
              <p>La consolidación de facturas se completó con <span class="badge-warning">advertencias</span>. Algunos registros presentaron errores de validación.</p>

              <p><strong>Ejecución:</strong> {run_id}<br>
              <strong>Fecha:</strong> {timestamp}</p>

              <p><strong>Archivos procesados:</strong></p>
              <ul>
                {archivos_procesados}
              </ul>

              <table class="summary-table">
                <tr><th>Métrica</th><th>Valor</th></tr>
                <tr><td>Registros insertados</td><td>{registros_insertados}</td></tr>
                <tr><td>Registros actualizados</td><td>{registros_actualizados}</td></tr>
                <tr><td>Registros sin cambios</td><td>{registros_sin_cambios}</td></tr>
                <tr><td>Total monto origen</td><td>{total_monto_origen}</td></tr>
                <tr><td>Total monto destino</td><td>{total_monto_destino}</td></tr>
                <tr><td>Varianza</td><td>{varianza}</td></tr>
              </table>

              <p><strong>Errores de validación:</strong></p>
              <table class="error-table">
                <tr><th>Fila</th><th>Error</th></tr>
                {errores_validacion}
              </table>

              <p>Se recomienda revisar los registros con errores manualmente.</p>
            </td>
          </tr>

          <!-- Footer -->
          <tr>
            <td class="email-footer">
              <p>&copy; 2025 Exportadora Santa Elena S.A.</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>

</html>
